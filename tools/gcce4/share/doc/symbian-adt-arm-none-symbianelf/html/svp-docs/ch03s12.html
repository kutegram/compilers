<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>3.12. Network Device</title><link rel="stylesheet" href="cs.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"><link rel="home" href="index.html" title="Symbian ADT Sourcery G++ Lite"><link rel="up" href="chap-devices.html" title="Chapter 3. Base Platform Devices"><link rel="prev" href="ch03s11.html" title="3.11. Snapshot Device"><link rel="next" href="ch03s13.html" title="3.13. NAND Flash Device"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.12. Network Device</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s11.html">Prev</a> </td><th width="60%" align="center">Chapter 3. Base Platform Devices</th><td width="20%" align="right"> <a accesskey="n" href="ch03s13.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id369706"></a>3.12. Network Device</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id369711"></a>3.12.1. Description</h3></div></div></div><p>
    This device provides a virtual Ethernet network device.  It is based on
    the Linux virtio-net interface.  For details of the Virtio interface
    see <a class="xref" href="chap-virtio.html" title="Chapter 4. Virtio">Chapter 4, &#8220;Virtio&#8221;</a>.
   </p><p>
    Two Virtio queues are used.  The first to receive incoming packets, and
    the second to transmit outgoing packets.
   </p><p>
    This first 256 bytes of device address space is control registers, as
    with other devices.  Offsets from 0x100 onwards provide access to the
    virtio-net config space, and accepts accesses of any size.
   </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id369736"></a>3.12.2. Sending Packets</h3></div></div></div><p>
    Each request should be start with a 10 byte header. This header is not
    currently used, and should be zeroed.  The remainder of the request
    constitutes the packet data.
   </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id369747"></a>3.12.3. Receiving Packets</h3></div></div></div><p>
    Requests in the receive queue should allocate space for a 10 byte header.
    When a packet arrives the device will fill in the header, and copy the
    packet data to the remainder of the request.  The header is currently
    unused and should be ignored.
   </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id369759"></a>3.12.4. Device Properties</h3></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">compatible</code></span></dt><dd><code class="literal">syborg,virtio-net</code></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id369787"></a>3.12.5. Registers</h3></div></div></div><p>
    </p><div class="table"><a name="id369794"></a><p class="title"><b>Table 3.11. Network Device Registers</b></p><div class="table-contents"><table summary="Network Device Registers" border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th>Offset</th><th>Access</th><th>Reset</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>0x000</td><td>R</td><td>0xc51d000a</td><td>ID</td><td><p>
          Peripheral ID.
        </p></td></tr><tr><td>0x004</td><td>R</td><td>0x00000001</td><td>DEVTYPE</td><td><p>
          Virtio device ID.
        </p></td></tr><tr><td>0x008</td><td>R</td><td>impl def</td><td>HOST_FEATURES</td><td><p>
          For future expansion.  Allows the device to expose a set of
          feature bits.
        </p></td></tr><tr><td>0x00c</td><td>RW</td><td>0x00000000</td><td>GUEST_FEATURES</td><td><p>
          For future expansion.  Allows the driver to acknowledge support for
          a set of features.
        </p></td></tr><tr><td>0x010</td><td>RW</td><td>0x00000000</td><td>QUEUE_BASE</td><td><p>
          Set the address of the selected virtqueue.  Should be aligned on
          a 4k boundary.
        </p></td></tr><tr><td>0x014</td><td>R</td><td>impl def</td><td>QUEUE_NUM</td><td><p>
          The size of the selected virtqueue ring.  Will be zero for
          unimplemented queues.
        </p></td></tr><tr><td>0x018</td><td>RW</td><td>0x00000000</td><td>QUEUE_SEL</td><td><p>
          Select which virtqueue is accesses by the
          <code class="literal">QUEUE_BASE</code> and <code class="literal">QUEUE_NUM</code>
          registers.  Writing a value of 0 selects is the first queue and
          writing 1 selects the second.
        </p></td></tr><tr><td>0x01c</td><td>W</td><td>N/A</td><td>QUEUE_NOTIFY</td><td><p>
          Notify the device that new requests have been placed in a virtqueue.
          The value written determines which queue is checked.
        </p></td></tr><tr><td>0x020</td><td>RW</td><td>0x00000000</td><td>STATUS</td><td><p>
          Set Virtio device status bits.  This is used to inform the device
          about the state of the OS driver.  The device will not begin
          servicing requests until the device driver indicates that it is
          ready.  A combination of the following bitflags should be used:
          </p><div class="variablelist"><dl><dt><span class="term">1</span></dt><dd><p>
              The device has been detected.
            </p></dd><dt><span class="term">2</span></dt><dd><p>
              A driver has been associated with the device.
            </p></dd><dt><span class="term">4</span></dt><dd><p>
              The device driver has completed initialization and it read
              for operation.
            </p></dd></dl></div><p>
         </p>
         <p>
          Writing zero to this register resets the device.
         </p>
        </td></tr><tr><td>0x024</td><td>RW</td><td>0x00000000</td><td>INT_ENABLE</td><td>
         <div class="variablelist"><dl><dt><span class="term"><code class="literal">0</code></span></dt><dd><p>
             Interrupt masked.
            </p></dd><dt><span class="term"><code class="literal">1</code></span></dt><dd><p>
             Interrupt enabled.
            </p></dd></dl></div>
        </td></tr><tr><td>0x028</td><td>RW</td><td>0x00000000</td><td>INT_STATUS</td><td><p>
          Write 0x00000001 to this register to clear the interrupt.
          Reads will have the low bit set if the notification
          interrupt is pending.
        </p></td></tr><tr><td>0x100</td><td>RW</td><td>impl def</td><td>config</td><td><p>
          The device config is accessible from this offset.  The first 6
          bytes of the device config can be read to determine the 
          device MAC address.
        </p></td></tr></tbody></table></div></div><p><br class="table-break">
   </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s11.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="chap-devices.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch03s13.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3.11. Snapshot Device </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 3.13. NAND Flash Device</td></tr></table></div></body></html>
