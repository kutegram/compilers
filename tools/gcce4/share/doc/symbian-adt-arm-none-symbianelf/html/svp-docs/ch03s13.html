<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>3.13. NAND Flash Device</title><link rel="stylesheet" href="cs.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"><link rel="home" href="index.html" title="Symbian ADT Sourcery G++ Lite"><link rel="up" href="chap-devices.html" title="Chapter 3. Base Platform Devices"><link rel="prev" href="ch03s12.html" title="3.12. Network Device"><link rel="next" href="ch03s14.html" title="3.14. Audio Device"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.13. NAND Flash Device</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s12.html">Prev</a> </td><th width="60%" align="center">Chapter 3. Base Platform Devices</th><td width="20%" align="right"> <a accesskey="n" href="ch03s14.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id370178"></a>3.13. NAND Flash Device</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id370183"></a>3.13.1. Description</h3></div></div></div><p>
    This provides NAND flash based storage.  The virtual device
    emulates a connection to a Samsung NAND flash chips such as the
    K9F2808U0A.
   </p><p>
    A backing file for the contents of the flash device can be specified
    using the <code class="literal">-drive if=mtd,file=<em class="replaceable"><code>filename.img</code></em></code>
    commandline option.  The size of the file is used to determine whether it
    includes the OOB data.  e.g. for a 128Mbit device a 16Mbyte file is
    treated as 512 byte blocks, with the additional 16 "spare" bytes per block
    being held in memory, and initially zeroed.  A 16.5Mbyte file is treated
    as a set of 528 byte blocks.  If no backing file then all the data is
    help in memory and discarded when the virtual machine terminates.
   </p><p>
    The device also contains an ECC engine to assist with software error
    detection and correction.  This maintains rolling parity bits
    based on the values read from and written to the <code class="literal">DATA</code>
    register.
   </p><p>
    Parity bits are calculated as follows:
    </p><div class="variablelist"><dl><dt><span class="term">P1'</span></dt><dd><p>
        bit0 ^ bit2 ^ bit4 ^ bit6 ^ bit8 ^ bit10 ^ bit12 ^ bit14 ...
       </p></dd><dt><span class="term">P1</span></dt><dd><p>
        bit1 ^ bit3 ^ bit5 ^ bit7 ^ bit9 ^ bit11 ^ bit13 ^ bit15 ...
       </p></dd><dt><span class="term">P2'</span></dt><dd><p>
        bit0 ^ bit1 ^ bit4 ^ bit5 ^ bit8 ^ bit9 ^ bit12 ^ bit13 ...
       </p></dd><dt><span class="term">P2</span></dt><dd><p>
        bit2 ^ bit3 ^ bit6 ^ bit7 ^ bit10 ^ bit11 ^ bit14 ^ bit15 ...
       </p></dd><dt><span class="term">P4'</span></dt><dd><p>
        bit0 ^ bit1 ^ bit2 ^ bit3 ^ bit8 ^ bit9 ^ bit10 ^ bit11 ...
       </p></dd><dt><span class="term">P4</span></dt><dd><p>
        bit4 ^ bit5 ^ bit6 ^ bit7 ^ bit12 ^ bit13 ^ bit14 ^ bit15 ...
       </p></dd></dl></div><p>
    etc.
   </p><p>
    The following devices are supported:
    </p><div class="informaltable"><table border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>Size (Mbit)</th><th>Chip ID</th><th>Page Size (bytes)</th><th>Erase Size (pages)</th></tr></thead><tbody><tr><td>1</td><td>0x6e</td><td>256</td><td>16</td></tr><tr><td>2</td><td>0x64</td><td>256</td><td>16</td></tr><tr><td>4</td><td>0x6b</td><td>512</td><td>16</td></tr><tr><td>8</td><td>0xd6</td><td>512</td><td>16</td></tr><tr><td>16</td><td>0x33</td><td>512</td><td>32</td></tr><tr><td>32</td><td>0x35</td><td>512</td><td>32</td></tr><tr><td>64</td><td>0x36</td><td>512</td><td>32</td></tr><tr><td>128</td><td>0x78</td><td>512</td><td>32</td></tr><tr><td>256</td><td>0x71</td><td>512</td><td>32</td></tr><tr><td>512</td><td>0xa2</td><td>2048</td><td>64</td></tr><tr><td>1024</td><td>0xa1</td><td>2048</td><td>64</td></tr><tr><td>2048</td><td>0xaa</td><td>2048</td><td>64</td></tr><tr><td>4096</td><td>0xac</td><td>2048</td><td>64</td></tr><tr><td>8192</td><td>0xa3</td><td>2048</td><td>64</td></tr><tr><td>16384</td><td>0xa5</td><td>2048</td><td>64</td></tr></tbody></table></div><p>
    All devices are 8 bits wide.
   </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id370550"></a>3.13.2. Device Properties</h3></div></div></div><div class="variablelist"><dl><dt><span class="term"><code class="literal">compatible</code></span></dt><dd><code class="literal">syborg,nand</code></dd><dt><span class="term"><code class="literal">size</code></span></dt><dd><p>
       The size of the flash device in Mbits.
      </p></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id370593"></a>3.13.3. Registers</h3></div></div></div><p>
    </p><div class="table"><a name="id370601"></a><p class="title"><b>Table 3.12. NAND Flash Device Registers</b></p><div class="table-contents"><table summary="NAND Flash Device Registers" border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th>Offset</th><th>Access</th><th>Reset</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>0x000</td><td>R</td><td>0xc51d000b</td><td>ID</td><td><p>
          Peripheral ID.
        </p></td></tr><tr><td>0x004</td><td>RW</td><td>impl def</td><td>DATA</td><td><p>
          The low 8 bits of this register map onto the 8 Data Input/Output
          pins on the flash chip.  The high 24 bits are ignored.
        </p></td></tr><tr><td>0x008</td><td>RW</td><td>0x00000000</td><td>CTL</td><td><p>
          Read or write flash chip control pins.  Bit mapping as as follows:
          </p><div class="variablelist"><dl><dt><span class="term">Bit0</span></dt><dd><p>
              Command Latch Enable.
             </p></dd><dt><span class="term">Bit1</span></dt><dd><p>
              Address Latch Enable.
             </p></dd><dt><span class="term">Bit2</span></dt><dd><p>
              Chip enable (active low).
             </p></dd><dt><span class="term">Bit3</span></dt><dd><p>
              Write Protect (active low).
             </p></dd><dt><span class="term">Bit4</span></dt><dd><p>
              Read(1)/Busy(0) Output.  Writes to this bit are ignored.
             </p></dd></dl></div><p>
        </p></td></tr><tr><td>0x00c</td><td>RW</td><td>0x00000000</td><td>ECC_COUNT</td><td><p>
          The number of bytes processed by the ECC engine.  Write zero to
          this register to reset the ECC engine.
        </p></td></tr><tr><td>0x010</td><td>RW</td><td>0x00000000</td><td>ECC_CP</td><td><p>
          ECC column parity.  Bit mappings as follows:
          </p><div class="variablelist"><dl><dt><span class="term">Bit0</span></dt><dd>P1'</dd><dt><span class="term">Bit1</span></dt><dd>P1</dd><dt><span class="term">Bit2</span></dt><dd>P2'</dd><dt><span class="term">Bit3</span></dt><dd>P2</dd><dt><span class="term">Bit4</span></dt><dd>P4'</dd><dt><span class="term">Bit5</span></dt><dd>P4</dd></dl></div><p>
          Bits 6-31 are unused and read as zero.
        </p></td></tr><tr><td>0x014</td><td>RW</td><td>0x00000000</td><td>ECC_LP</td><td><p>
          ECC line parity.  Bit0=P8', Bit1=P8, Bit2=P16', Bit3=P16, etc.
        </p></td></tr></tbody></table></div></div><p><br class="table-break">
   </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s12.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="chap-devices.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch03s14.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">3.12. Network Device </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 3.14. Audio Device</td></tr></table></div></body></html>
